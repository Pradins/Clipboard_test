# Ticket Breakdown
We are a staffing company whose primary purpose is to book Agents at Shifts posted by Facilities on our platform. We're working on a new feature which will generate reports for our client Facilities containing info on how many hours each Agent worked in a given quarter by summing up every Shift they worked. Currently, this is how the process works:

- Data is saved in the database in the Facilities, Agents, and Shifts tables
- A function `getShiftsByFacility` is called with the Facility's id, returning all Shifts worked that quarter, including some metadata about the Agent assigned to each
- A function `generateReport` is then called with the list of Shifts. It converts them into a PDF which can be submitted by the Facility for compliance.

## You've been asked to work on a ticket. It reads:

**Currently, the id of each Agent on the reports we generate is their internal database id. We'd like to add the ability for Facilities to save their own custom ids for each Agent they work with and use that id when generating reports for them.**


Based on the information given, break this ticket down into 2-5 individual tickets to perform. Provide as much detail for each ticket as you can, including acceptance criteria, time/effort estimates, and implementation details. Feel free to make informed guesses about any unknown details - you can't guess "wrong".


You will be graded on the level of detail in each ticket, the clarity of the execution plan within and between tickets, and the intelligibility of your language. You don't need to be a native English speaker, but please proof-read your work.

## Your Breakdown Here

### I assumed the structure of the database as follows:


Table [Facilities]

ID 				UUID
NAME			text


Table [Agents] (name and surname as the metadata)

ID 				UUID
NAME			text
SURNAME			text


Table [Shifts]

ID 				UUID
facility_id		Foreign key Facilities.id
agent_id		Foreing key Agents.id
start_date		Date
end_date		Date
num_hours		number (calculated value on shift creation to materialize the num of hours end_date - start_date)



#### To store this "Agent id per Facility" I decided to create another table:


Table [Facility_custom_agent_id]

ID					UUID
facility_id			Foreign key Facilities.id
agent_id			Foreing key Agents.id
custom_agent_id 	text



## Tasks:

- Create new table Facility_custom_agent_id (2 story points)
- Update getShiftsByFacility function to return the alias asigned to the shift (3-5 story points)
- Update genetareReport function to add the agent alias on the resulting PDF (3-5 story points)


### Create new table Facility_custom_agent_id

As am I used to work all the database structure including changes are handled by changelogs that are applied on every stage (dev, prod etc) at deployment.

ticket:

	description: 

	As the facilities want to have custom ids for every agent that work there we need to store the ids that facilities might give to 
	each of the agents working on their shifts.

	Acceptance criteria: 

	Create new table "Facility_custom_agent_id" with the following structure: 

		ID					UUID (autogenerated by DB)
		facility_id			Foreign key Facilities.id
		agent_id			Foreing key Agents.id
		custom_agent_id 	UUID (not null)


	Expected result: 

	- A new table is created in the DDBB with the specified name and table structure.
	- Table must have no records.



### Update getShiftsByFacility

ticket:

	description: 

	Function getShiftsByFacility need to be updated to return the custom_agent_id asigned by the facility.
	For every shift returned by getShiftsByFacility a new field "facility_agent_id" needs to be added.


	Agents alias are stored in a new table named "Facility_custom_agent_id" with the following structure: 

		ID					UUID (autogenerated by DB)
		facility_id			Foreign key Facilities.id
		agent_id			Foreing key Agents.id
		custom_agent_id 	text (not null)

	agent alias is stored in the "custom_agent_id" column.


	Acceptance criteria: 

		scenario 1: Agent HAS NO custom_agent_id declared in the facility that owns the shift: 

			Shifts are returned as it have been returned until now but with a new field "facility_agent_id" with NULL value.

		scenario 2: Agent HAS custom_agent_id declared in the facility that owns the shift: 

			Shifts are returned as it have been returned until now but with a new field "facility_agent_id" with agent's custom_agent_id.


	Expected result: 

		- A new field "facility_agent_id" is returned for every shift returned by "getShiftsByFacility". "facility_agent_id" containes the id that the facility asigned to that agent if they have any.

		- All the tests covering this function including unit test and E2E test are updated and cover the new scenarios described in the acceptance criteria



### Update generateReport

I asume that the shifts passed by parameter to this function have a structure like:

{
agent_id: '1234', 					// Agent id as in the table Agents
facility_agent_id : '0987' | NULL, 	// Custom agent id asigned to the agent by the facility
...
}


ticket:

	description: 

	Existing Agent id field in the reports need to be updated to show the facility_agent_id given by the facility


	Agent "facility_agent_id" need to be included in the generated reports.
	generateReport reciving shifts now include a new field named "facility_agent_id" containing the alias that the facility gave to the agent, if any.
	The "facility_agent_id" value will be the one displayed in the "Agent Id" field if "facility_agent_id" has a value. If "facility_agent_id" the agent_id will be displayed in the "Agent Id" field. 

	Acceptance criteria: 

		scenario 1: Shift "facility_agent_id" contains a NULL value

			field "Agent Id" displays the value of the agent_id.

		scenario 2: Shift "facility_agent_id" contains a value

			field "Agent Id" displays the value of the "facility_agent_id".


	Expected result: 

	- Reports shifts show the "facility_agent_id" value in the "Agent id" field if the shift's "facility_agent_id" field is not null.
	- Reports shifts show the "agent_id" value in the "Agent id" field if the shift's "facility_agent_id" field is null.
	- All the tests covering this function including unit test and E2E test are updated and cover the new scenarios described in the acceptance criteria



## Considerations

The task description says "We'd like to add the ability for Facilities to save their own custom ids for each Agent they work with ..." from that I understand that facilities will be given that opition from now on. But that does not mean that all of them will create a "custom_agent_id" for every agent they work with. Asuming that posibility we still need to support the current agent_id in the [SHIFTS] table.

The task asks to replace the current "id" field of the report with the new (possibly null value) "custom_agent_id". Asuming that "custom_agent_id" might be null that leads to unconsistency of the generated reports since whoever reads that will not know if the ID listed in the report is the agent id or the custom agent id given by the facility.

A possible solution for that would be to include both id's in the report as "Agent Id" "Facility agent Id" for example. Then the information given by the report would be much more clear.
